name: update-catalog

on:
  workflow_dispatch:
  schedule:
    - cron: '0 7 * * */2'


jobs:
  new_content:
    runs-on: ubuntu-latest
    steps:
      - name: Add new content to catalog
        run: |
          curl --request GET \
          --url "https://www.streamorskip.com/api/cron/addToCatalog" \
          --header "apikey: secrets.NEXT_PUBLIC_SUPABASE_ANON_KEY, Authorization: Bearer secrets.SUPABASE_KEY"
      - name: Add ratings
        run: |
          curl --request GET \
          --url "https://www.streamorskip.com/api/cron/rating" \
          --header "apikey: secrets.NEXT_PUBLIC_SUPABASE_ANON_KEY, Authorization: Bearer secrets.SUPABASE_KEY"
      - name: Add genres
        run: |
          curl --request GET \
          --url "https://www.streamorskip.com/api/cron/genre" \
          --header "apikey: secrets.NEXT_PUBLIC_SUPABASE_ANON_KEY, Authorization: Bearer secrets.SUPABASE_KEY"
      - name: Check for deleted content
        run: |
          curl --request GET \
          --url "https://www.streamorskip.com/api/cron/removeFromCatalog" \
          --header "apikey: secrets.NEXT_PUBLIC_SUPABASE_ANON_KEY, Authorization: Bearer secrets.SUPABASE_KEY"